<!DOCTYPE HTML>
<html>
  <head>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <style>
      .subtitle { color: #555; }
      #annotation { margin: 6px 0; font-weight: 500;  color: #FFA500}
    </style>
  </head>
  <body onload='init()'>
    <h1>Bangladesh Crime Narrative Vis</h1>
    <div class="slide-header">
      <div class="slide-title" id="slide-title"></div>
      <div class="subtitle" id="slide-subtitle"></div>
    </div>
    <div id="controls">
      <label>
        Year:
        <input type="range" id="year-slider" min="2010" max="2025" step="1" value="2010">
        <span id="year-label">2010</span>
      </label>
    </div>
    <div class="nav">
      <button id="back-btn">Back</button>
      <button id="next-btn">Next</button>
      <span id="progress"></span>
    </div>

    <div id="annotation"></div>
    <svg width="500" height="500"></svg>
    
    <script>
      async function init() {
        // Load & Clean
        const data = await d3.csv("BD_Crime.csv", function(d) { 
          return { 
            unit: d["Names of Unit"].trim(),
            year: +d["Year"],
            dacoity: +d["Dacoity"],
            robbery: +d["Robbery"],
            murder: +d[" Murder"],
            speedy: +d[" Speedy Trial"],
            riot: +d[" Riot"],
            woman_child: +d[" Woman & Child Repression"],
            kidnapping: +d[" Kidnapping"],
            police_assault: +d[" Police Assault"],
            burglary: +d[" Burglary"],
            theft: +d[" Theft"],
            other: +d[" Other Cases"],
            arms: +d["Arms Act"],
            explosive: +d[" Explosive Act"],
            narcotics: +d[" Narcotics"],
            smuggling: +d["Smuggling"],
            total: +d["Total Cases"]
          };
        });
        
        const svg = d3.select("svg");
        
        const totalByYear = d3.nest()
            .key(function(d) {return d.year})
            .rollup(values => d3.sum(values, d => d.total))
            .entries(data)
            .map(d => ({ year: +d.key, total: d.value }))
            .sort((a,b)=>a.year - b.year);;
    
        
        const state = {
          sceneIndex: 0,
          year: 2010,
          //focusCategory: "woman_child" // can be changed per scene
        };
    
        const width = +svg.attr("width") - 50;
        const height = +svg.attr("height") - 50;
        const margin = { top: 20, right: 20, bottom: 40, left: 60 };
    
        const xScale = d3.scaleLinear().range([margin.left, margin.left + width]);
        const yScale = d3.scaleLinear().range([margin.top + height, margin.top]);

        const xAxisGroup = svg.append("g").attr("transform", "translate(0, 430)");
        const yAxisGroup = svg.append("g").attr("transform", "translate(60, 0)");
        const path = svg.append("path")
          .attr("fill", "none")
          .attr("stroke", "#1E90FF")
          .attr("stroke-width", 3);
        
        
        const scenes = [
          {
            name: "National Trend",
            title: "Crime Trends in Bangladesh (2010–2020)",
            subtitle: "Total cases by year",
            showYear: false,
            render: () => {
              d3.select("#slide-title").text(scenes[0].title);
              d3.select("#slide-subtitle").text(scenes[0].subtitle);
              d3.select("#annotation").text("A steady increase in crime is seen nationally.");
    
              // Prepare data
              const pre2020 = totalByYear.filter(function(d) {return d.year <= 2020})
              xScale.domain(d3.extent(pre2020, function(d) {return d.year}));
              yScale.domain([0, d3.max(pre2020, function(d) {return d.total}) * 1.05]);
    
    
              // Line generator
              const line = d3.line()
                .x(function(d) {return xScale(d.year)})
                .y(function(d) {return yScale(d.total)})
                .curve(d3.curveMonotoneX);
    
              // Transitions
              xAxisGroup.transition().duration(1000)
                .call(d3.axisBottom(xScale).tickFormat(d3.format("d")));
              
              yAxisGroup.transition().duration(1000)
                .call(d3.axisLeft(yScale));
              
              path.datum(pre2020)
                .transition().duration(1000)
                .attr("d", line);
            }
          },
          {
            name: "National Trend Post Covid",
            title: "Crime Trends in Bangladesh (2010–2025)",
            subtitle: "Total cases by year",
            showYear: false,
            render: () => {
              d3.select("#slide-title").text(scenes[0].title);
              d3.select("#slide-subtitle").text(scenes[0].subtitle);
              d3.select("#annotation").text("Crime has begun to steadily decrease after the pandemic.");
    
              // Prepare data
              const post2020 = totalByYear.filter(function(d) {return d.year > 2020})
              xScale.domain(d3.extent(ppst2020, function(d) {return d.year}));
              yScale.domain([0, d3.max(post2020, function(d) {return d.total}) * 1.05]);
    
    
              // Line generator
              const line = d3.line()
                .x(function(d) {return xScale(d.year)})
                .y(function(d) {return yScale(d.total)})
                .curve(d3.curveMonotoneX);
    
              // Transitions
              xAxisGroup.transition().duration(1000)
                .call(d3.axisBottom(xScale).tickFormat(d3.format("d")));
              
              yAxisGroup.transition().duration(1000)
                .call(d3.axisLeft(yScale));
              
              path.datum(post2020)
                .transition().duration(1000)
                .attr("d", line);
            }
          }
        ];
    
    
        // Visualize the current scene
        function renderScene() {
          state.sceneIndex = Math.max(0, Math.min(scenes.length - 1, state.sceneIndex));
          d3.select("#progress").text(`${state.sceneIndex + 1} / ${scenes.length}`);

          
          // Year Slider visibility
          d3.select("#controls").style("display", scenes[state.sceneIndex].showYear ? null : "none");
          if(scenes[state.sceneIndex].showYear){
            d3.select("#year-label").text(state.year);
          }

          // Button Visibility
          d3.select("#back-btn").style("display", state.sceneIndex=0 ? null : "none");
          d3.select("#next-btn").style("display", state.sceneIndex=scenes.length-1 ? null : "none");
          
          scenes[state.sceneIndex].render();
        }
    
    
        // Triggers
        d3.select("#next-btn").on("click", () => {
          state.sceneIndex += 1;
          renderScene();
        });
        d3.select("#back-btn").on("click", () => {
          state.sceneIndex -= 1;
          renderScene();
        });
    
        d3.select("#year-slider").on("input", function() {
          state.year = +this.value;
          d3.select("#year-label").text(state.year);
          
          if (scenes[state.sceneIndex].name === "Category Breakdown") {
            renderScene();
          }
        });

        
        renderScene();
    
        
      }
    </script>
  </body>
</html>


  
